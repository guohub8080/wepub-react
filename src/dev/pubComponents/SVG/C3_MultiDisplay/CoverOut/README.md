# CoverOut 组件

## 概述

`CoverOut` 是一个 SVG 动画组件，实现多张图片**层层退出**的效果：所有图片叠加在一起，依次滑出退场，露出下层图片。

## 效果描述

- 所有图片初始叠加在一起（图1在最上，图n在最下）
- 图1停留一段时间后滑出，露出图2
- 图2停留一段时间后滑出，露出图3
- 依此类推，直到最后一张图滑出
- 无缝循环，从头开始

## 使用示例

```tsx
import CoverOut from "@pubSVG/C3_MultiDisplay/CoverOut";

<CoverOut 
  pics={[
    { 
      url: pic1, 
      direction: "L",         // 往左退出
      stayDuration: 1.0,      // 停留1秒
      coverOutDuration: 0.5   // 0.5秒滑出
    },
    { 
      url: pic2, 
      direction: "R",         // 往右退出
      stayDuration: 1.5,      
      coverOutDuration: 0.8   
    },
    { 
      url: pic3, 
      direction: "B",         // 往下退出
      stayDuration: 2.0,      
      coverOutDuration: 0.6   
    },
  ]} 
/>
```

## Props

### `pics`
类型：`Array<PicConfig>`

图片配置数组，每个元素包含：

| 属性 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `url` | `string` | 必填 | 图片URL |
| `direction` | `"T" \| "B" \| "L" \| "R"` | `"B"` | 滑出方向：T-往上, B-往下, L-往左, R-往右 |
| `stayDuration` | `number` | `0.5` | 停留时长（秒） |
| `coverOutDuration` | `number` | `0.5` | 滑出动画时长（秒） |

### `viewBoxW` / `viewBoxH`
类型：`number`（可选）

自定义 viewBox 尺寸。如果不提供，会自动从第一张图片获取。

### `mp`
类型：`mpProps`（可选）

Margin/Padding 样式配置。

## 动画时间线

以 4 张图为例：

```
时间轴：0 ────────────────────────────────────────────────────────────> T
        
图1:    [══════════last═══════════][out]
图2:                                    [══════════last═══════════][out]
图3:                                                                    [══════════last═══════════][out]
图4:                                                                                                    [══════════last═══════════][out]
假动作:                                                                                                 [═══════════════════════════]
        └─────────────────────────────────────────────────────────────────────────────────────────────┘
                                         循环回到开始
```

### 假动作层的巧思

为了实现无缝循环，我们使用了一个巧妙的"假动作层"技术：

#### 问题
在循环动画中，最后一张图滑出时，它下面应该显示第一张图（因为循环会回到开头），但实际上第一张图的动画还在"屏外位置"等待重置。

#### 解决方案
在所有主循环层的最下面，放置一个"假动作"的第一张图：

1. **出现时机**：在图1到图(n-1)的(last+out)累加 + 图n的last时间后
   - 即：恰好在最后一张图开始滑出时
2. **持续时间**：与最后一张图的out动画时长相同
3. **消失时机**：在最后一张图滑出结束的瞬间
4. **图层位置**：在所有主循环层的下面

#### 技术实现

使用 **离散跳变** 而非魔法数字：

```tsx
<animate
  attributeName="opacity"
  values="0;0;1;1;0;0"
  keyTimes="0;kt2;kt2;kt3;kt3;1"  // 重复的keyTime值实现瞬间跳变
  calcMode="discrete"              // 离散模式，无平滑过渡
  dur="totalCycleDuration"
  repeatCount="indefinite"
/>
```

**为什么用离散跳变？**
- ❌ 避免使用 `0.99999` 等魔法数字，长时间可能累积误差
- ✅ 通过重复的 `keyTimes` 值（如 `kt2;kt2`）实现精确的瞬间切换
- ✅ `calcMode="discrete"` 确保是离散跳变而非平滑过渡
- ✅ 与主循环层完全同步，不会产生闪烁

#### 视觉效果
从用户视角看，图4开始滑出时，下面有图1（实际是假动作），图4刚滑走，假动作消失，主循环层的图1从头开始——完美衔接！

## 组件结构

```
CoverOut/
├── index.tsx                 # 主组件：协调所有图层
├── CoverOutPicOne.tsx        # 主循环层：每张图的滑出动画
├── CoverOutGhostPicOne.tsx   # 假动作层：循环连接的视觉技巧
└── README.md                 # 本文档
```

## 技术细节

### 主循环层 (`CoverOutPicOne.tsx`)
- 所有图片从时间 0 开始，使用 `repeatCount="indefinite"` 无限循环
- 每张图在自己的时间点等待 → 滑出 → 保持屏外 → 循环重置
- 使用 `animateTransform` 实现位移动画

### 假动作层 (`CoverOutGhostPicOne.tsx`)
- 只渲染第一张图的副本
- 使用 opacity 动画在特定时刻瞬间出现/消失
- 使用 `calcMode="discrete"` 实现离散跳变
- 图层在所有主循环层的下面

### 渲染顺序
从下到上：
1. 假动作层（图1的Ghost版本）
2. 图n（最下层）
3. 图n-1
4. ...
5. 图1（最上层）

## 注意事项

1. **图片数量**：至少需要1张图片
2. **时长设置**：建议 `coverOutDuration` 不要太短（< 0.3s），否则动画会显得仓促
3. **方向组合**：不同图片可以使用不同的滑出方向，创造丰富的视觉效果
4. **性能**：SVG 动画性能较好，适合在移动端使用

## 与 CoverIn 的区别

| 特性 | CoverOut | CoverIn |
|------|----------|---------|
| 动画方向 | 图片滑出退场 | 图片滑入覆盖 |
| 初始状态 | 所有图叠加在一起 | 第一张图显示 |
| 视觉效果 | 层层揭示 | 层层覆盖 |
| 循环技巧 | 假动作层填补空白 | 两轮动画无缝衔接 |

