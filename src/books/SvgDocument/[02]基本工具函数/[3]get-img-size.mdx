export const title = "图片尺寸自动获取"
export const icon = "BookOpen"

# {title}

SVG 动画组件通常需要统一尺寸的图片。手动测量每张图片并填入宽高既低效又容易出错，此工具可自动获取图片尺寸，或使用手动指定的值覆盖。

## 设计理念

- 多数组件默认以**第一张图**为基准获取尺寸
- 优先使用手动指定的 `viewBoxW` 或 `viewBoxH`（覆盖自动获取）
- 避免重复的手动测量工作，提高开发效率

## 函数签名

```typescript
getImgSizeByDefault(url: string, w?: number, h?: number): { w: number, h: number }
```

**⚠️ 重要：这是一个响应式 Hook 函数**

内部使用了 `useMemo` 和异步图片加载。当图片加载完成时，返回的 `{ w, h }` 会自动更新，触发组件重新渲染。

## 参数说明

- `url`: 图片 URL 地址
- `w`: 可选，指定宽度（优先级高于自动获取）
- `h`: 可选，指定高度（优先级高于自动获取）

## 工作原理（响应式更新）

1. **优先使用指定值**：如果提供了 w 或 h，直接返回指定的值
2. **异步加载图片**：如果没有提供，会在后台异步加载图片
3. **响应式更新**：图片加载完成后，返回值会自动更新为实际尺寸
4. **触发重渲染**：由于使用了 `useMemo`，值更新会触发组件重新渲染

```typescript
// 内部实现简化版
const getImgSizeByDefault = (url, w?, h?) => {
    const imgSizeAutoGet = getImgSizeAsync(url); // 异步获取

    const imgSize = useMemo(() => {
        if (w || h) return { w, h };  // 优先返回指定值

        // 当 imgSizeAutoGet 更新时，useMemo 会重新计算
        if (imgSizeAutoGet.isSuccess) {
            return { w: imgSizeAutoGet.w, h: imgSizeAutoGet.h };
        }

        return { w: 0, h: 0 };  // 初始值
    }, [imgSizeAutoGet, w, h]);

    return imgSize;  // 响应式返回值
}
```

## 使用示例

### 示例1：手动指定宽高

明确知道需要的尺寸时，直接指定宽高（最常用）

```typescript
const canvasSize = getImgSizeByDefault(pic1, 300, 200);
// 返回: { w: 300, h: 200 }
```

### 示例2：只指定宽度

只提供宽度时，高度会被设为 0（需要配合其他逻辑处理）

```typescript
const canvasSize = getImgSizeByDefault(pic1, 375);
// 返回: { w: 375, h: 0 }
```

### 示例3：自动获取图片尺寸（响应式更新）

不提供宽高时，会异步加载图片。加载完成后自动更新返回值

```typescript
const canvasSize = getImgSizeByDefault(pic1);
// 初始值: { w: 0, h: 0 }
// 图片加载后自动更新为: { w: 实际宽度, h: 实际高度 }
// 更新时会触发组件重新渲染
```

**渲染流程：**

1. 初次渲染：`canvasSize = { w: 0, h: 0 }`
2. 异步加载图片...
3. 加载完成后：`canvasSize` 自动更新为实际尺寸
4. 触发组件重新渲染，显示正确尺寸

## 实际应用场景

在组件中动态设置 SVG viewBox（以第一张图为基准）

```typescript
const AnyPush = (props: {
    pics?: { url: string }[]
    viewBoxW?: number  // 手动指定宽度（覆盖自动获取）
    viewBoxH?: number  // 手动指定高度（覆盖自动获取）
}) => {
    // 关键逻辑：
    // 1. 使用第一张图的 URL 作为基准
    // 2. 如果提供了 viewBoxW/H，优先使用（覆盖）
    // 3. 否则自动获取第一张图的实际尺寸
    const canvasSize = getImgSizeByDefault(
        props.pics?.[0]?.url,
        props.viewBoxW,
        props.viewBoxH
    );

    return (
        <SvgEx
            viewBox={`0 0 ${canvasSize.w} ${canvasSize.h}`}
            width="100%"
        >
            {/* 所有图片都会按这个 viewBox 尺寸显示 */}
        </SvgEx>
    );
}
```

**使用示例：**

```typescript
// 场景1: 自动获取第一张图尺寸
<AnyPush pics={[
    { url: "pic1.jpg" },  // 作为基准
    { url: "pic2.jpg" },
]} />

// 场景2: 手动指定统一尺寸（推荐）
<AnyPush
    viewBoxW={375}
    viewBoxH={667}
    pics={[
        { url: "pic1.jpg" },
        { url: "pic2.jpg" },
    ]}
/>
```

## 最佳实践与注意事项

- ✅ **推荐做法**：手动指定 viewBoxW/H（性能最好，避免响应式更新）
- 📐 **核心价值**：统一所有图片尺寸，无需逐个测量
- 🎯 **设计模式**：以第一张图为基准，其他图自动适配
- ⚠️ **异步特性**：这是响应式 Hook，返回值会随图片加载完成而自动更新
- 🔄 **渲染影响**：自动获取时，初次渲染为 `{ w: 0, h: 0 }`，加载后触发重渲染
- 💡 **性能优化**：内部使用 `useMemo` 缓存，避免不必要的重复计算
